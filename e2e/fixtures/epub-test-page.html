<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>epub.js e2e test</title>
    <script type="module">
      // Try to import the ESM bundle and expose it on window
      try {
        import('/dist/epub.js')
          .then((m) => {
            // default export
            const lib = m.default || m;
            window.ePub = lib;
          })
          .catch(() => {
            // fallback handled below
          });
      } catch (e) {
        // ignore, fallback handled below
      }
    </script>
    <script>
      // Classic fallback for non-ESM bundles
      function loadScript(src) {
        return new Promise((resolve, reject) => {
          const s = document.createElement('script');
          s.src = src;
          s.onload = resolve;
          s.onerror = reject;
          document.head.appendChild(s);
        });
      }
      (async function () {
        // if module import didn't populate window.ePub within 1s, try classic script
        const wait = (ms) => new Promise((r) => setTimeout(r, ms));
        await wait(1000);
        if (typeof window.ePub !== 'function') {
          try {
            await loadScript('/lib/epub.js');
          } catch (e) {
            console.error('No bundle found');
          }
        }
      })();
    </script>
  </head>
  <body>
    <h1>epub.js e2e test harness</h1>
  </body>
</html>
